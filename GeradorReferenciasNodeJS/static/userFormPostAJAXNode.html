<html>
	
<head>
	<script type="text/javascript" charset="utf-8">
		function generateXMLHttp() 
		{	//browser diferentes do IE?
			if (typeof XMLHttpRequest != "undefined") 
			{	//retorna requisicao AJAX
				return new XMLHttpRequest(); 
			} else
			{	//browser eh IE?
				if (window.ActiveXObject) 
				{	//carrega as versoes
					var versions = ["MSXML2.XMLHttp.5.0", 
									"MSXML2.XMLHttp.4.0", 
									"MSXML2.XMLHttp.3.0",
									"MSXML2.XMLHttp", 
									"Microsoft.XMLHttp"
									];
				}
			}
			//tenta criar objeto da versao mais recente
			for (var i = 0; i < versions.length; i++) 
			{	try
				{	//retorna requisicao AJAX
					return new ActiveXObject(versions[i]); 
				} catch(e)
				{
				}
			}
			//informa que o browser nao suporte AJAX
			alert("Seu navegador nÃ£o pode trabalhar com Ajax!"); 
		}

		function cadastraPessoa(event)
		{	event.preventDefault();
		 	//criando requisicao AJAX
			var request = generateXMLHttp();

			//define a funcao de callback que vai tratar os dados quando chegar
			request.onreadystatechange = function()
			{	//testa se o estado eh o final
				if (request.readyState == 4)
				{	//testa se a resposta foi Ok
					if (request.status == 200)
					{	//obtem o objeto pessoa enviada pelo servidor
						var pessoa = JSON.parse(request.responseText);
						console.log(pessoa);
						var listaPessoas = document.getElementById("listaPessoas");
						var itemPessoa = document.createElement("li");
						itemPessoa.innerHTML = "Nome: " + pessoa.first_name + " Sobrenome: " + pessoa.last_name;
						listaPessoas.appendChild(itemPessoa);
						
					}	
				}
			};
		 
			//configurando a requisicao
			//parametro 1: tipo de envio GET ou POST
			//parametro 2: a pagina e valores de parametros HTTP
			//parametro 3: requisicao deve funcionar de forma assincrona ou nao?
			request.open("post", "cadastrarPessoa" , true);
		 	request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
			//envia a requisicao
		 	var firstNameInput = document.getElementById("first_name");
		 	var lastNameInput = document.getElementById("last_name");
		 	request.send("first_name=" + firstNameInput.value + "&last_name=" + lastNameInput.value);
		}	
	</script>
</head>
	
<body>
	<h1>Cadastro de pessoas</h1>
	<form method="POST">
        First Name: <input id="first_name" type="text" name="first_name">  <br/>
        Last Name: <input id="last_name" type="text" name="last_name">
        <input type="submit" value="Submit" onclick="cadastraPessoa(event)">
    </form>
	<h1>Lista de pessoas</h1>
	<ul id="listaPessoas">	
	</ul>	
</body>
</html>